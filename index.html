<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vibe Link // Tactical Model</title>
    <!-- Tailwind CSS for instant styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Blue Backlit LCD Scrollbar */
        #messages::-webkit-scrollbar { width: 4px; }
        #messages::-webkit-scrollbar-thumb { background-color: #3b82f6; border-radius: 2px; }
        #messages::-webkit-scrollbar-track { background-color: #eff6ff; }
        
        /* Subtle pixel grid for the screen */
        .pixel-grid {
            background-image: 
                linear-gradient(rgba(0, 0, 0, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 0, 0, 0.05) 1px, transparent 1px);
            background-size: 3px 3px;
        }

        /* Knob texture */
        .knurled {
            background-image: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 2px,
                rgba(0,0,0,0.5) 2px,
                rgba(0,0,0,0.5) 4px
            );
        }
    </style>
</head>
<body class="bg-neutral-800 h-screen w-full flex flex-col items-center justify-center font-sans overflow-hidden pt-16 sm:pt-0">

    <!-- The Walkie Talkie Device Container 
         UPDATED: h-[90dvh] ensures it fits on mobile screens. 
         mt-4 pushes it down slightly to show antenna. 
    -->
    <div class="relative bg-zinc-900 p-6 pb-6 rounded-[2.5rem] shadow-2xl border-r-8 border-b-8 border-black w-[95%] max-w-sm h-[85dvh] sm:h-auto sm:min-h-[600px] flex flex-col items-center transform transition-transform">
        
        <!-- Top Hardware (Knobs & Antenna) -->
        <div class="absolute -top-12 left-8 w-6 h-32 bg-zinc-800 rounded-t-full border-l border-zinc-700 shadow-xl z-0 flex flex-col justify-end pb-2">
            <div class="w-full h-1 bg-black/30 mb-1"></div>
            <div class="w-full h-1 bg-black/30 mb-1"></div>
            <div class="w-full h-1 bg-black/30"></div>
        </div> <!-- Antenna -->

        <div class="absolute -top-8 right-16 w-10 h-10 bg-zinc-800 rounded-sm border-2 border-zinc-950 shadow-lg z-10 knurled"></div> <!-- Vol Knob -->
        <div class="absolute -top-8 right-4 w-8 h-8 bg-zinc-800 rounded-sm border-2 border-zinc-950 shadow-lg z-10 knurled"></div> <!-- Channel Knob -->

        <!-- Branding Area -->
        <div class="w-full flex justify-between items-end mb-2 px-2 shrink-0">
            <div class="text-zinc-500 text-[10px] font-bold tracking-widest italic">VIBE-LINK <span class="text-white">DP-D10</span></div>
            <div class="flex gap-1">
                <div id="status-led" class="w-3 h-3 rounded-full bg-red-600 border border-black shadow-[0_0_5px_rgba(220,38,38,0.5)]"></div>
            </div>
        </div>

        <!-- The Screen (White/Blue Backlit) 
             UPDATED: Removed fixed height, added flex-1 to fill available space 
        -->
        <div class="w-full bg-blue-50 p-1 rounded-sm border-[3px] border-zinc-700 shadow-[inset_0_2px_6px_rgba(0,0,0,0.4)] mb-4 relative z-20 flex-1 min-h-0 flex flex-col">
            <!-- Screen Header -->
            <div class="flex justify-between items-center px-2 py-1 border-b border-blue-200 text-blue-900/60 text-[10px] font-bold font-mono shrink-0">
                <span>CH: 446.0025</span>
                <span class="tracking-tighter">||||| bat</span>
            </div>

            <!-- Messages Area -->
            <ul id="messages" class="flex-1 overflow-y-auto p-2 space-y-1 font-mono text-sm text-blue-950 pixel-grid">
                 <li class="text-center text-blue-900/40 text-xs mt-10">Waiting for signal...</li>
            </ul>
        </div>
        
        <!-- Keypad / Input Area -->
        <form id="form" class="w-full flex flex-col gap-3 z-20 mb-4 shrink-0">
            <!-- Simulated Digital Display Input -->
            <div class="relative bg-zinc-800 rounded p-1 border border-zinc-700">
                <input id="input" autocomplete="off" placeholder="ENTER FREQUENCY/TEXT..." 
                       class="w-full bg-zinc-900/50 border-none rounded px-3 py-2 text-white placeholder-zinc-500 focus:outline-none focus:ring-1 focus:ring-blue-500 font-mono text-sm uppercase tracking-wide" />
            </div>

            <!-- Keypad Visuals (Decorative) & PTT -->
            <div class="grid grid-cols-3 gap-2 mb-1 opacity-30 pointer-events-none">
                <div class="h-1.5 bg-zinc-700 rounded-sm"></div>
                <div class="h-1.5 bg-zinc-700 rounded-sm"></div>
                <div class="h-1.5 bg-zinc-700 rounded-sm"></div>
            </div>

            <button class="w-full bg-zinc-800 hover:bg-zinc-700 text-white font-bold py-4 rounded shadow-[0_4px_0_rgba(0,0,0,1)] active:shadow-none active:translate-y-[4px] border-t border-zinc-600 transition-all flex items-center justify-center gap-2 group">
                <div class="w-3 h-3 rounded-full bg-orange-600 group-hover:bg-orange-500"></div>
                TRANSMIT
            </button>
        </form>

        <!-- Speaker Grill (Bottom) -->
        <div class="w-full px-6 flex flex-col gap-1.5 opacity-60 shrink-0">
            <div class="w-full h-1.5 bg-black rounded-full shadow-[inset_0_1px_1px_rgba(255,255,255,0.1)]"></div>
            <div class="w-full h-1.5 bg-black rounded-full shadow-[inset_0_1px_1px_rgba(255,255,255,0.1)]"></div>
            <div class="w-full h-1.5 bg-black rounded-full shadow-[inset_0_1px_1px_rgba(255,255,255,0.1)]"></div>
            <div class="w-2/3 h-1.5 bg-black rounded-full shadow-[inset_0_1px_1px_rgba(255,255,255,0.1)] mx-auto"></div>
        </div>

    </div>

    <!-- Socket.io Client Library -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    
    <script>
        // --- CONFIGURATION ---
        const BACKEND_URL = "https://walky-production.up.railway.app"; 

        // Initialize Socket
        const socket = io(BACKEND_URL || "http://localhost:3000");

        const form = document.getElementById('form');
        const input = document.getElementById('input');
        const messages = document.getElementById('messages');
        const statusLed = document.getElementById('status-led');

        // 1. Connection Status Indicators
        socket.on('connect', () => {
            statusLed.classList.replace('bg-red-600', 'bg-green-500');
            statusLed.classList.add('shadow-[0_0_8px_rgba(34,197,94,0.8)]');
            addSystemMessage("LINK ESTABLISHED");
        });

        socket.on('disconnect', () => {
            statusLed.classList.replace('bg-green-500', 'bg-red-600');
            statusLed.classList.remove('shadow-[0_0_8px_rgba(34,197,94,0.8)]');
            addSystemMessage("SIGNAL LOST");
        });

        // 2. Sending Messages
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            if (input.value) {
                socket.emit('chat message', input.value);
                input.value = '';
            }
        });

        // 3. Receiving Messages
        socket.on('chat message', (msg) => {
            const item = document.createElement('li');
            item.className = "break-words leading-tight py-1 border-b border-blue-200/30";
            // Mimic radio protocol style
            item.innerHTML = `<span class="font-bold mr-1">></span> ${msg}`;
            messages.appendChild(item);
            messages.scrollTop = messages.scrollHeight;
        });

        function addSystemMessage(text) {
            const item = document.createElement('li');
            item.className = "text-center text-[10px] text-blue-900/50 uppercase tracking-widest mt-2 mb-2";
            item.textContent = `*** ${text} ***`;
            messages.appendChild(item);
            messages.scrollTop = messages.scrollHeight;
        }
    </script>
</body>
</html>
