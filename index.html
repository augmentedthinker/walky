<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibe Link // Walkie Talkie</title>
    <!-- Tailwind CSS for instant styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom scrollbar for the chat feed */
        #messages::-webkit-scrollbar { width: 6px; }
        #messages::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 4px; }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 h-screen flex flex-col items-center justify-center font-sans">

    <div class="w-full max-w-md h-full flex flex-col bg-slate-800 shadow-xl sm:rounded-xl sm:h-[90vh] sm:border border-slate-700 overflow-hidden">
        
        <!-- Header -->
        <div class="bg-indigo-600 p-4 flex justify-between items-center shadow-md z-10">
            <h1 class="font-bold text-lg tracking-wider">VIBE LINK <span class="text-indigo-300 text-xs">v0.1</span></h1>
            <div id="status" class="w-3 h-3 rounded-full bg-red-500 animate-pulse" title="Disconnected"></div>
        </div>

        <!-- Chat Feed -->
        <ul id="messages" class="flex-1 overflow-y-auto p-4 space-y-3">
            <!-- Messages will appear here -->
            <li class="text-center text-slate-500 text-sm italic">Initializing link...</li>
        </ul>

        <!-- Input Area -->
        <form id="form" class="bg-slate-700 p-4 flex gap-2 border-t border-slate-600">
            <input id="input" autocomplete="off" placeholder="Type a message..." 
                   class="flex-1 bg-slate-900 border border-slate-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-indigo-500 transition-colors" />
            <button class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg transition-transform active:scale-95">Send</button>
        </form>
    </div>

    <!-- Socket.io Client Library -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    
    <script>
        // --- CONFIGURATION ---
        // REPLACE THE EMPTY STRING BELOW WITH YOUR RAILWAY URL AFTER DEPLOYMENT
        // Example: const BACKEND_URL = "https://vibe-link-production.up.railway.app";
        // Leave null to attempt local connection (localhost:3000)
        const BACKEND_URL = "https://walky-production.up.railway.app"; 

        // Initialize Socket
        // If BACKEND_URL is null, it defaults to window.location (good for localhost)
        const socket = io(BACKEND_URL || "http://localhost:3000");

        const form = document.getElementById('form');
        const input = document.getElementById('input');
        const messages = document.getElementById('messages');
        const statusLight = document.getElementById('status');

        // 1. Connection Status Indicators
        socket.on('connect', () => {
            statusLight.classList.replace('bg-red-500', 'bg-green-500');
            statusLight.title = "Connected";
            addSystemMessage("Link established.");
        });

        socket.on('disconnect', () => {
            statusLight.classList.replace('bg-green-500', 'bg-red-500');
            statusLight.title = "Disconnected";
            addSystemMessage("Link lost.");
        });

        // 2. Sending Messages
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            if (input.value) {
                // Emit the event to the server
                socket.emit('chat message', input.value);
                input.value = '';
            }
        });

        // 3. Receiving Messages
        socket.on('chat message', (msg) => {
            const item = document.createElement('li');
            item.className = "bg-slate-600 p-3 rounded-lg rounded-tl-none self-start max-w-[85%] break-words shadow-sm";
            item.textContent = msg;
            messages.appendChild(item);
            
            // Auto-scroll to bottom
            messages.scrollTop = messages.scrollHeight;
        });

        function addSystemMessage(text) {
            const item = document.createElement('li');
            item.className = "text-center text-xs text-slate-500 uppercase tracking-widest mt-2 mb-2";
            item.textContent = text;
            messages.appendChild(item);
            messages.scrollTop = messages.scrollHeight;
        }
    </script>
</body>
</html>